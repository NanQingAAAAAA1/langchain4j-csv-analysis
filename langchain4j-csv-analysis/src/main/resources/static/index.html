<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>职位数据分析仪表板</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        /* 三栏布局样式 - 大屏效果 */
        .layout-container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr; /* 等宽三列 */
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .left-column, .center-column, .right-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }
        
        .chart-container:hover {
            transform: translateY(-5px);
        }
        
        .chart-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .chart {
            width: 100%;
            height: 400px; /* 固定高度，与城市薪资TOP10和学历薪资关系一致 */
        }
        
        /* 按钮面板样式 */
        .button-panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex;
            justify-content: space-between;
            gap: 15px;
            flex-shrink: 0; /* 不压缩高度 */
        }
        
        .action-btn {
            flex: 1;
            padding: 15px 20px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        }
        
        .action-btn:active {
            transform: translateY(0);
        }
        
        .company-list {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .company-list h3 {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .company-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
            transition: all 0.3s ease;
        }
        
        .company-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }
        
        .company-name {
            font-weight: bold;
            color: #333;
            font-size: 1.1em;
            margin-bottom: 5px;
        }
        
        .company-details {
            color: #666;
            font-size: 0.9em;
        }
        
        /* 自动滚动样式 */
        .company-scroll-container {
            height: 400px; /* 固定高度，与其他图表一致 */
            overflow: hidden;
            position: relative;
            border-radius: 8px;
            background: #f8f9fa;
        }
        
        .company-scroll-content {
            animation: scrollUp 60s linear infinite;
            padding: 10px;
        }
        
        .company-scroll-content:hover {
            animation-play-state: paused;
        }
        
        @keyframes scrollUp {
            0% {
                transform: translateY(0);
            }
            100% {
                transform: translateY(-50%);
            }
        }
        
        .loading {
            text-align: center;
            color: white;
            font-size: 1.2em;
            padding: 50px;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }
        
        @media (max-width: 768px) {
            .layout-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .button-panel {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
                <div class="header">
            <h1>🤖 AIGC求职助手</h1>
        </div>
        
        <div id="loading" class="loading">
            <p>正在加载数据...</p>
        </div>
        
        <div id="content" style="display: none;">
            <div class="layout-container">
                <!-- 左侧栏 -->
                <div class="left-column">
                    <!-- 城市薪资TOP10 - 柱状图 -->
                    <div class="chart-container">
                        <div class="chart-title">🏙️ 城市薪资TOP10</div>
                        <div id="citySalaryChart" class="chart"></div>
                    </div>
                    
                    <!-- 学历薪资关系 - 玫瑰图 -->
                    <div class="chart-container">
                        <div class="chart-title">🎓 学历薪资关系</div>
                        <div id="educationSalaryChart" class="chart"></div>
                    </div>
                    
                    <!-- 公司信息滚动列表 -->
                    <div class="company-list">
                        <h3>🏢 公司信息列表</h3>
                        <div id="companyList" class="company-scroll-container"></div>
                    </div>
                </div>
                
                <!-- 中间栏 -->
                <div class="center-column">
                    <!-- 按钮区域 -->
                    <div class="button-panel">
                        <button class="action-btn" id="btn1">按钮1</button>
                        <button class="action-btn" id="btn2">按钮2</button>
                        <button class="action-btn" id="btn3">按钮3</button>
                        <button class="action-btn" id="btn4">按钮4</button>
                    </div>
                    
                    <!-- 中国地图 - 全国城市职位数量分布 -->
                    <div class="chart-container">
                        <div class="chart-title">🗺️ 全国城市职位数量分布</div>
                        <div id="chinaMap" class="chart"></div>
                    </div>
                </div>
                
                <!-- 右侧栏 -->
                <div class="right-column">
                    <!-- 城市职位数量TOP10 - 散点图 -->
                    <div class="chart-container">
                        <div class="chart-title">📊 城市职位数量TOP10</div>
                        <div id="cityJobCountChart" class="chart"></div>
                    </div>
                    
                    <!-- 学历要求分布 - 饼图 -->
                    <div class="chart-container">
                        <div class="chart-title">🎓 学历要求分布</div>
                        <div id="educationDistributionChart" class="chart"></div>
                    </div>
                    
                    <!-- 学历经验关系 - 热力图 -->
                    <div class="chart-container">
                        <div class="chart-title">🔥 学历经验关系热力图</div>
                        <div id="educationExperienceChart" class="chart"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 全局变量存储数据
        let analysisData = null;
        
        // 加载数据
        async function loadData() {
            try {
                let apiData = null;
                
                // 尝试从API获取城市平均薪资数据
                try {
                    const apiResponse = await fetch('http://localhost:9090/loadChart/getCityAverageSalary');
                    if (apiResponse.ok) {
                        apiData = await apiResponse.json();
                        console.log('API数据获取成功:', apiData);
                    } else {
                        console.warn('API请求失败，使用本地数据');
                    }
                } catch (apiError) {
                    console.warn('API调用失败，使用本地数据:', apiError);
                }
                
                // 从本地JSON文件获取数据
                const localResponse = await fetch('/json/sql_analysis_result.json');
                if (!localResponse.ok) {
                    throw new Error('无法加载本地数据文件');
                }
                const localData = await localResponse.json();
                
                // 合并数据
                analysisData = {
                    ...localData,
                    '城市薪资TOP10': apiData || localData['城市薪资TOP10'] // 如果API失败，使用本地数据
                };
                
                console.log('最终加载的数据:', analysisData); // 调试用
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';
                renderAllCharts();
            } catch (error) {
                console.error('加载数据失败:', error);
                document.getElementById('loading').innerHTML = `
                    <div class="error">
                        <p>❌ 加载数据失败: ${error.message}</p>
                        <p>请确保analysis_result.json文件存在于resources/json目录下</p>
                    </div>
                `;
            }
        }
        
                 // 渲染所有图表
         function renderAllCharts() {
             renderCitySalaryChart();
             renderEducationSalaryChart();
             renderCompanyList();
             renderEducationExperienceChart();
             renderCityJobCountChart();
             renderEducationDistributionChart();
             renderChinaMap();
         }
        
                 // 城市薪资TOP10 - 柱状图
         function renderCitySalaryChart() {
             const chart = echarts.init(document.getElementById('citySalaryChart'));
             const data = analysisData['城市薪资TOP10'] || [];
             
             const option = {
                 tooltip: {
                     trigger: 'axis',
                     formatter: function(params) {
                         const data = params[0];
                         return `${data.name}<br/>平均薪资: ${data.value}元`;
                     }
                 },
                 grid: {
                     left: '3%',
                     right: '4%',
                     bottom: '3%',
                     containLabel: true
                 },
                 xAxis: {
                     type: 'category',
                     data: data.map(item => item.cityName),
                     axisLabel: {
                         rotate: 45,
                         fontSize: 12
                     }
                 },
                 yAxis: {
                     type: 'value',
                     name: '平均薪资(元)',
                     axisLabel: {
                         formatter: function(value) {
                             return (value / 1000).toFixed(0) + 'k';
                         }
                     }
                 },
                 series: [{
                     data: data.map(item => item.avgSalary),
                     type: 'bar',
                     itemStyle: {
                         color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                             { offset: 0, color: '#83bff6' },
                             { offset: 0.5, color: '#188df0' },
                             { offset: 1, color: '#188df0' }
                         ])
                     },
                     emphasis: {
                         itemStyle: {
                             color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                 { offset: 0, color: '#2378f7' },
                                 { offset: 0.7, color: '#2378f7' },
                                 { offset: 1, color: '#83bff6' }
                             ])
                         }
                     }
                 }]
             };
             
             chart.setOption(option);
         }
        
        // 学历薪资关系 - 玫瑰图
        function renderEducationSalaryChart() {
            const chart = echarts.init(document.getElementById('educationSalaryChart'));
            const data = analysisData['学历薪资关系'] || [];
            
            const option = {
                tooltip: {
                    trigger: 'item',
                    formatter: '{a} <br/>{b}: {c}元 ({d}%)'
                },
                legend: {
                    orient: 'vertical',
                    left: 'left'
                },
                series: [{
                    name: '平均薪资',
                    type: 'pie',
                    radius: ['40%', '70%'],
                    center: ['50%', '50%'],
                    roseType: 'radius',
                    data: data.map(item => ({
                        name: item.educationLevel,
                        value: item.avgSalary
                    })),
                    itemStyle: {
                        borderRadius: 8
                    },
                    label: {
                        formatter: '{b}: {c}元'
                    }
                }]
            };
            
            chart.setOption(option);
        }
        
        // 公司信息滚动列表
        function renderCompanyList() {
            const companyList = document.getElementById('companyList');
            const data = analysisData['公司信息'] || [];
            
            if (data.length === 0) {
                companyList.innerHTML = '<p style="text-align: center; color: #666;">暂无公司信息</p>';
                return;
            }
            
            // 限制显示前50家公司
            const displayData = data.slice(0, 50);
            
            // 创建滚动容器
            companyList.innerHTML = `
                <div class="company-scroll-container">
                    <div class="company-scroll-content">
                        ${displayData.map(company => `
                            <div class="company-item">
                                <div class="company-name">${company.companyName || '未知公司'}</div>
                                <div class="company-details">
                                    经验要求: ${company.experienceLevel || '不限'} | 
                                    学历要求: ${company.educationLevel || '不限'} | 
                                    薪资: ${company.salary || '面议'}
                                </div>
                            </div>
                        `).join('')}
                        ${displayData.map(company => `
                            <div class="company-item">
                                <div class="company-name">${company.companyName || '未知公司'}</div>
                                <div class="company-details">
                                    经验要求: ${company.experienceLevel || '不限'} | 
                                    学历要求: ${company.educationLevel || '不限'} | 
                                    薪资: ${company.salary || '面议'}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            if (data.length > 50) {
                companyList.innerHTML += `
                    <div style="text-align: center; color: #666; margin-top: 20px;">
                        显示前50条记录，共${data.length}条公司信息
                    </div>
                `;
            }
        }
        
        // 学历经验关系 - 热力图
        function renderEducationExperienceChart() {
            const chart = echarts.init(document.getElementById('educationExperienceChart'));
            const data = analysisData['学历经验关系'] || [];
            
            // 提取唯一的学历和经验值
            const educationLevels = [...new Set(data.map(item => item.educationLevel))];
            const experienceLevels = [...new Set(data.map(item => item.experienceLevel))];
            
            // 构建热力图数据
            const heatmapData = [];
            educationLevels.forEach((edu, eduIndex) => {
                experienceLevels.forEach((exp, expIndex) => {
                    const item = data.find(d => d.educationLevel === edu && d.experienceLevel === exp);
                    if (item) {
                        heatmapData.push([expIndex, eduIndex, item.jobCount]);
                    }
                });
            });
            
            const option = {
                tooltip: {
                    position: 'top',
                    formatter: function(params) {
                        const edu = educationLevels[params.data[1]];
                        const exp = experienceLevels[params.data[0]];
                        return `${edu} + ${exp}<br/>职位数量: ${params.data[2]}`;
                    }
                },
                grid: {
                    height: '70%',
                    top: '10%'
                },
                xAxis: {
                    type: 'category',
                    data: experienceLevels,
                    splitArea: {
                        show: true
                    },
                    axisLabel: {
                        rotate: 45
                    }
                },
                yAxis: {
                    type: 'category',
                    data: educationLevels,
                    splitArea: {
                        show: true
                    }
                },
                visualMap: {
                    min: 0,
                    max: Math.max(...data.map(item => item.jobCount)),
                    calculable: true,
                    orient: 'horizontal',
                    left: 'center',
                    bottom: '15%',
                    inRange: {
                        color: ['#313695', '#4575b4', '#74add1', '#abd9e9', '#e0f3f8', '#ffffcc', '#fee090', '#fdae61', '#f46d43', '#d73027', '#a50026']
                    }
                },
                series: [{
                    name: '职位数量',
                    type: 'heatmap',
                    data: heatmapData,
                    label: {
                        show: true,
                        formatter: function(params) {
                            return params.data[2];
                        }
                    },
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 10,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }]
            };
            
            chart.setOption(option);
        }
        
                 // 城市职位数量TOP10 - 散点图
         function renderCityJobCountChart() {
             const chart = echarts.init(document.getElementById('cityJobCountChart'));
             const data = analysisData['城市职位数量TOP10'] || [];
             
             // 生成散点图数据：x轴为城市名称，y轴为职位数量
             const scatterData = data.map((item, index) => [index, item.jobCount]);
             const cityNames = data.map(item => item.cityName);
             
             const option = {
                 tooltip: {
                     trigger: 'item',
                     formatter: function(params) {
                         const cityName = cityNames[params.data[0]];
                         return `${cityName}<br/>职位数量: ${params.data[1]}个`;
                     }
                 },
                 grid: {
                     left: '15%',
                     right: '10%',
                     top: '15%',
                     bottom: '25%'
                 },
                 xAxis: {
                     type: 'category',
                     name: '城市',
                     nameLocation: 'middle',
                     nameGap: 30,
                     data: cityNames,
                     axisLabel: {
                         rotate: 45,
                         fontSize: 12,
                         interval: 0
                     }
                 },
                 yAxis: {
                     type: 'value',
                     name: '职位数量',
                     nameLocation: 'middle',
                     nameGap: 40
                 },
                 series: [{
                     name: '城市职位数量',
                     type: 'scatter',
                     symbolSize: function(value) {
                         // 根据职位数量动态调整点的大小
                         return Math.max(8, Math.min(20, value[1] / 10));
                     },
                     data: scatterData,
                     itemStyle: {
                         color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                             { offset: 0, color: '#ff6b6b' },
                             { offset: 0.5, color: '#4ecdc4' },
                             { offset: 1, color: '#45b7d1' }
                         ]),
                         opacity: 0.8
                     },
                     emphasis: {
                         itemStyle: {
                             shadowBlur: 10,
                             shadowColor: 'rgba(0, 0, 0, 0.3)',
                             opacity: 1
                         }
                     }
                 }]
             };
             
             chart.setOption(option);
         }
        
                 // 学历要求分布 - 饼图
         function renderEducationDistributionChart() {
             const chart = echarts.init(document.getElementById('educationDistributionChart'));
             const data = analysisData['学历要求分布'] || [];
             
             const option = {
                 tooltip: {
                     trigger: 'item',
                     formatter: '{a} <br/>{b}: {c}个职位 ({d}%)'
                 },
                 legend: {
                     orient: 'vertical',
                     left: 'left',
                     type: 'scroll'
                 },
                 series: [{
                     name: '学历要求',
                     type: 'pie',
                     radius: '55%',
                     center: ['50%', '50%'],
                     data: data.map(item => ({
                         name: item.educationLevel,
                         value: item.jobCount
                     })),
                     roseType: 'radius',
                     label: {
                         formatter: '{b}: {c}'
                     },
                     itemStyle: {
                         borderRadius: 8
                     },
                     emphasis: {
                         itemStyle: {
                             shadowBlur: 10,
                             shadowOffsetX: 0,
                             shadowColor: 'rgba(0, 0, 0, 0.5)'
                         }
                     }
                 }]
             };
             
             chart.setOption(option);
         }
        
                 // 城市到省份映射函数 - 适配阿里云DataV地图数据（使用完整省份名称）
         function getCityProvince(cityName) {
             // 直辖市映射 - 使用完整名称
             const municipalities = {
                 '北京': '北京市',
                 '上海': '上海市', 
                 '天津': '天津市',
                 '重庆': '重庆市'
             };
             
             // 特别行政区映射
             const specialRegions = {
                 '香港': '香港特别行政区',
                 '澳门': '澳门特别行政区'
             };
             
             // 其他城市到省份映射 - 使用阿里云DataV的完整省份名称
             const cityToProvince = {
                 '广州': '广东省', '深圳': '广东省', '珠海': '广东省', '汕头': '广东省', '佛山': '广东省', '韶关': '广东省', '湛江': '广东省', '肇庆': '广东省', '江门': '广东省', '茂名': '广东省', '惠州': '广东省', '梅州': '广东省', '汕尾': '广东省', '河源': '广东省', '阳江': '广东省', '清远': '广东省', '东莞': '广东省', '中山': '广东省', '潮州': '广东省', '揭阳': '广东省', '云浮': '广东省',
                 '杭州': '浙江省', '宁波': '浙江省', '温州': '浙江省', '嘉兴': '浙江省', '湖州': '浙江省', '绍兴': '浙江省', '金华': '浙江省', '衢州': '浙江省', '舟山': '浙江省', '台州': '浙江省', '丽水': '浙江省',
                 '南京': '江苏省', '无锡': '江苏省', '徐州': '江苏省', '常州': '江苏省', '苏州': '江苏省', '南通': '江苏省', '连云港': '江苏省', '淮安': '江苏省', '盐城': '江苏省', '扬州': '江苏省', '镇江': '江苏省', '泰州': '江苏省', '宿迁': '江苏省',
                 '济南': '山东省', '青岛': '山东省', '淄博': '山东省', '枣庄': '山东省', '东营': '山东省', '烟台': '山东省', '潍坊': '山东省', '济宁': '山东省', '泰安': '山东省', '威海': '山东省', '日照': '山东省', '莱芜': '山东省', '临沂': '山东省', '德州': '山东省', '聊城': '山东省', '滨州': '山东省', '菏泽': '山东省',
                 '郑州': '河南省', '开封': '河南省', '洛阳': '河南省', '平顶山': '河南省', '安阳': '河南省', '鹤壁': '河南省', '新乡': '河南省', '焦作': '河南省', '濮阳': '河南省', '许昌': '河南省', '漯河': '河南省', '三门峡': '河南省', '南阳': '河南省', '商丘': '河南省', '信阳': '河南省', '周口': '河南省', '驻马店': '河南省',
                 '武汉': '湖北省', '黄石': '湖北省', '十堰': '湖北省', '宜昌': '湖北省', '襄阳': '湖北省', '鄂州': '湖北省', '荆门': '湖北省', '孝感': '湖北省', '荆州': '湖北省', '黄冈': '湖北省', '咸宁': '湖北省', '随州': '湖北省',
                 '长沙': '湖南省', '株洲': '湖南省', '湘潭': '湖南省', '衡阳': '湖南省', '邵阳': '湖南省', '岳阳': '湖南省', '常德': '湖南省', '张家界': '湖南省', '益阳': '湖南省', '郴州': '湖南省', '永州': '湖南省', '怀化': '湖南省', '娄底': '湖南省',
                 '成都': '四川省', '自贡': '四川省', '攀枝花': '四川省', '泸州': '四川省', '德阳': '四川省', '绵阳': '四川省', '广元': '四川省', '遂宁': '四川省', '内江': '四川省', '乐山': '四川省', '南充': '四川省', '眉山': '四川省', '宜宾': '四川省', '广安': '四川省', '达州': '四川省', '雅安': '四川省', '巴中': '四川省', '资阳': '四川省',
                 '西安': '陕西省', '铜川': '陕西省', '宝鸡': '陕西省', '咸阳': '陕西省', '渭南': '陕西省', '延安': '陕西省', '汉中': '陕西省', '榆林': '陕西省', '安康': '陕西省', '商洛': '陕西省',
                 '合肥': '安徽省', '芜湖': '安徽省', '蚌埠': '安徽省', '淮南': '安徽省', '马鞍山': '安徽省', '淮北': '安徽省', '铜陵': '安徽省', '安庆': '安徽省', '黄山': '安徽省', '滁州': '安徽省', '阜阳': '安徽省', '宿州': '安徽省', '六安': '安徽省', '亳州': '安徽省', '池州': '安徽省', '宣城': '安徽省',
                 '福州': '福建省', '厦门': '福建省', '莆田': '福建省', '三明': '福建省', '泉州': '福建省', '漳州': '福建省', '南平': '福建省', '龙岩': '福建省', '宁德': '福建省',
                 '南昌': '江西省', '景德镇': '江西省', '萍乡': '江西省', '九江': '江西省', '新余': '江西省', '鹰潭': '江西省', '赣州': '江西省', '吉安': '江西省', '宜春': '江西省', '抚州': '江西省', '上饶': '江西省',
                 '石家庄': '河北省', '唐山': '河北省', '秦皇岛': '河北省', '邯郸': '河北省', '邢台': '河北省', '保定': '河北省', '张家口': '河北省', '承德': '河北省', '沧州': '河北省', '廊坊': '河北省', '衡水': '河北省',
                 '太原': '山西省', '大同': '山西省', '阳泉': '山西省', '长治': '山西省', '晋城': '山西省', '朔州': '山西省', '晋中': '山西省', '运城': '山西省', '忻州': '山西省', '临汾': '山西省', '吕梁': '山西省',
                 '呼和浩特': '内蒙古自治区', '包头': '内蒙古自治区', '乌海': '内蒙古自治区', '赤峰': '内蒙古自治区', '通辽': '内蒙古自治区', '鄂尔多斯': '内蒙古自治区', '呼伦贝尔': '内蒙古自治区', '巴彦淖尔': '内蒙古自治区', '乌兰察布': '内蒙古自治区',
                 '沈阳': '辽宁省', '大连': '辽宁省', '鞍山': '辽宁省', '抚顺': '辽宁省', '本溪': '辽宁省', '丹东': '辽宁省', '锦州': '辽宁省', '营口': '辽宁省', '阜新': '辽宁省', '辽阳': '辽宁省', '盘锦': '辽宁省', '铁岭': '辽宁省', '朝阳': '辽宁省', '葫芦岛': '辽宁省',
                 '长春': '吉林省', '吉林': '吉林省', '四平': '吉林省', '辽源': '吉林省', '通化': '吉林省', '白山': '吉林省', '松原': '吉林省', '白城': '吉林省',
                 '哈尔滨': '黑龙江省', '齐齐哈尔': '黑龙江省', '鸡西': '黑龙江省', '鹤岗': '黑龙江省', '双鸭山': '黑龙江省', '大庆': '黑龙江省', '伊春': '黑龙江省', '佳木斯': '黑龙江省', '七台河': '黑龙江省', '牡丹江': '黑龙江省', '黑河': '黑龙江省', '绥化': '黑龙江省',
                 '昆明': '云南省', '曲靖': '云南省', '玉溪': '云南省', '保山': '云南省', '昭通': '云南省', '丽江': '云南省', '普洱': '云南省', '临沧': '云南省',
                 '贵阳': '贵州省', '六盘水': '贵州省', '遵义': '贵州省', '安顺': '贵州省', '毕节': '贵州省', '铜仁': '贵州省',
                 '南宁': '广西壮族自治区', '柳州': '广西壮族自治区', '桂林': '广西壮族自治区', '梧州': '广西壮族自治区', '北海': '广西壮族自治区', '防城港': '广西壮族自治区', '钦州': '广西壮族自治区', '贵港': '广西壮族自治区', '玉林': '广西壮族自治区', '百色': '广西壮族自治区', '贺州': '广西壮族自治区', '河池': '广西壮族自治区', '来宾': '广西壮族自治区', '崇左': '广西壮族自治区',
                 '海口': '海南省', '三亚': '海南省', '三沙': '海南省', '儋州': '海南省',
                 '兰州': '甘肃省', '嘉峪关': '甘肃省', '金昌': '甘肃省', '白银': '甘肃省', '天水': '甘肃省', '武威': '甘肃省', '张掖': '甘肃省', '平凉': '甘肃省', '酒泉': '甘肃省', '庆阳': '甘肃省', '定西': '甘肃省', '陇南': '甘肃省',
                 '西宁': '青海省', '海东': '青海省',
                 '银川': '宁夏回族自治区', '石嘴山': '宁夏回族自治区', '吴忠': '宁夏回族自治区', '固原': '宁夏回族自治区', '中卫': '宁夏回族自治区',
                 '乌鲁木齐': '新疆维吾尔自治区', '克拉玛依': '新疆维吾尔自治区',
                 '拉萨': '西藏自治区', '日喀则': '西藏自治区', '昌都': '西藏自治区', '林芝': '西藏自治区', '山南': '西藏自治区', '那曲': '西藏自治区',
                 '台北': '台湾省', '高雄': '台湾省', '基隆': '台湾省', '台中': '台湾省', '台南': '台湾省', '新竹': '台湾省', '嘉义': '台湾省'
             };
             
             // 检查直辖市
             if (municipalities[cityName]) {
                 return municipalities[cityName];
             }
             
             // 检查特别行政区
             if (specialRegions[cityName]) {
                 return specialRegions[cityName];
             }
             
             // 检查其他城市
             if (cityToProvince[cityName]) {
                 return cityToProvince[cityName];
             }
             
             // 如果没找到映射，返回原城市名
             return cityName;
         }
         
         // 计算省份职位数量
         function calculateProvinceSalary(cityJobData) {
             console.log('开始计算省份数据，输入数据:', cityJobData);
             
             const provinceData = {};
             
             cityJobData.forEach(item => {
                 const province = getCityProvince(item.cityName);
                 console.log(`城市 ${item.cityName} 映射到省份: ${province}`);
                 
                 if (!provinceData[province]) {
                     provinceData[province] = {
                         totalJobs: 0,
                         cities: []
                     };
                 }
                 
                 provinceData[province].totalJobs += item.jobCount;
                 provinceData[province].cities.push(item.cityName);
             });
             
             const result = Object.keys(provinceData).map(province => ({
                 name: province,
                 value: provinceData[province].totalJobs
             }));
             
             console.log('省份数据计算结果:', result);
             return result;
         }
         
         // 中国地图渲染函数
         async function renderChinaMap() {
             try {
                 console.log('开始渲染中国地图...');
                 
                 let chinaMapData = null;
                 
                 // 尝试加载中国地图数据
                 try {
                     const mapResponse = await fetch('https://geo.datav.aliyun.com/areas_v3/bound/100000_full.json');
                     if (mapResponse.ok) {
                         chinaMapData = await mapResponse.json();
                         console.log('地图数据加载成功，省份数量:', chinaMapData.features.length);
                         

                     } else {
                         throw new Error('地图数据请求失败');
                     }
                 } catch (mapError) {
                     console.warn('无法从阿里云加载地图数据，尝试使用备用方案:', mapError);
                     
                     // 备用方案：使用简化的中国地图数据
                     chinaMapData = {
                         type: "FeatureCollection",
                         features: [
                             { type: "Feature", properties: { name: "北京" }, geometry: { type: "Polygon", coordinates: [[[116.0, 40.0], [117.0, 40.0], [117.0, 39.0], [116.0, 39.0], [116.0, 40.0]]] } },
                             { type: "Feature", properties: { name: "上海" }, geometry: { type: "Polygon", coordinates: [[[121.0, 31.0], [122.0, 31.0], [122.0, 30.0], [121.0, 30.0], [121.0, 31.0]]] } },
                             { type: "Feature", properties: { name: "广东" }, geometry: { type: "Polygon", coordinates: [[[113.0, 23.0], [114.0, 23.0], [114.0, 22.0], [113.0, 22.0], [113.0, 23.0]]] } },
                             { type: "Feature", properties: { name: "江苏" }, geometry: { type: "Polygon", coordinates: [[[118.0, 32.0], [119.0, 32.0], [119.0, 31.0], [118.0, 31.0], [118.0, 32.0]]] } },
                             { type: "Feature", properties: { name: "浙江" }, geometry: { type: "Polygon", coordinates: [[[120.0, 30.0], [121.0, 30.0], [121.0, 29.0], [120.0, 29.0], [120.0, 30.0]]] } },
                             { type: "Feature", properties: { name: "四川" }, geometry: { type: "Polygon", coordinates: [[[103.0, 30.0], [104.0, 30.0], [104.0, 29.0], [103.0, 29.0], [103.0, 30.0]]] } },
                             { type: "Feature", properties: { name: "湖北" }, geometry: { type: "Polygon", coordinates: [[[114.0, 30.0], [115.0, 30.0], [115.0, 29.0], [114.0, 29.0], [114.0, 30.0]]] } },
                             { type: "Feature", properties: { name: "湖南" }, geometry: { type: "Polygon", coordinates: [[[112.0, 28.0], [113.0, 28.0], [113.0, 27.0], [112.0, 27.0], [112.0, 28.0]]] } },
                             { type: "Feature", properties: { name: "广西" }, geometry: { type: "Polygon", coordinates: [[[108.0, 23.0], [109.0, 23.0], [109.0, 22.0], [108.0, 22.0], [108.0, 23.0]]] } },
                             { type: "Feature", properties: { name: "辽宁" }, geometry: { type: "Polygon", coordinates: [[[122.0, 41.0], [123.0, 41.0], [123.0, 40.0], [122.0, 40.0], [122.0, 41.0]]] } }
                         ]
                     };
                     console.log('使用备用地图数据');
                 }
                 
                 const chart = echarts.init(document.getElementById('chinaMap'));
                 const cityJobData = analysisData['城市职位数量'] || [];
                 
                 console.log('城市职位数据:', cityJobData);
                 
                 // 注册地图
                 echarts.registerMap('china', chinaMapData);
                 
                 // 计算省份数据
                 const provinceData = calculateProvinceSalary(cityJobData);
                 
                 console.log('计算后的省份数据:', provinceData);
                 
                 // 检查是否有数据
                 if (provinceData.length === 0) {
                     console.warn('没有省份数据，显示空地图');
                     const option = {
                         tooltip: {
                             trigger: 'item',
                             formatter: function(params) {
                                 return `${params.name}<br/>暂无数据`;
                             }
                         },
                         series: [{
                             name: '职位数量',
                             type: 'map',
                             map: 'china',
                             roam: true,
                             emphasis: {
                                 label: {
                                     show: true,
                                     fontSize: 12
                                 },
                                 itemStyle: {
                                     areaColor: '#ff6b6b',
                                     shadowBlur: 10,
                                     shadowColor: 'rgba(0, 0, 0, 0.3)'
                                 }
                             },
                             select: {
                                 disabled: true
                             },
                             data: []
                         }]
                     };
                     chart.setOption(option);
                     return;
                 }
                 
                 // 计算颜色范围
                 const maxValue = Math.max(...provinceData.map(item => item.value));
                 const minValue = Math.min(...provinceData.map(item => item.value));
                 
                 console.log('数据范围:', { minValue, maxValue });
                 
                 const option = {
                     tooltip: {
                         trigger: 'item',
                         formatter: function(params) {
                             if (params.data) {
                                 return `${params.name}<br/>职位数量: ${params.value.toLocaleString()}个`;
                             }
                             return `${params.name}<br/>暂无数据`;
                         }
                     },
                     visualMap: {
                         type: 'continuous',
                         min: minValue,
                         max: maxValue,
                         left: 'left',
                         top: 'bottom',
                         text: ['高', '低'],
                         calculable: true,
                         inRange: {
                             color: ['#e0f3f8', '#abd9e9', '#74add1', '#4575b4', '#313695']
                         },
                         textStyle: {
                             color: '#333'
                         }
                     },
                     series: [{
                         name: '职位数量',
                         type: 'map',
                         map: 'china',
                         roam: true,
                         emphasis: {
                             label: {
                                 show: true,
                                 fontSize: 12
                             },
                             itemStyle: {
                                 areaColor: '#ff6b6b',
                                 shadowBlur: 10,
                                 shadowColor: 'rgba(0, 0, 0, 0.3)'
                             }
                         },
                         select: {
                             disabled: true
                         },
                         data: provinceData
                     }]
                 };
                 
                 chart.setOption(option);
                 console.log('中国地图渲染完成');
                 
             } catch (error) {
                 console.error('加载中国地图失败:', error);
                 // 显示错误信息
                 const chart = echarts.init(document.getElementById('chinaMap'));
                 chart.setOption({
                     title: {
                         text: '地图加载失败',
                         left: 'center',
                         top: 'center',
                         textStyle: {
                             color: '#ff6b6b',
                             fontSize: 16
                         }
                     }
                 });
             }
         }
         
         // 页面加载完成后执行
         document.addEventListener('DOMContentLoaded', function() {
             loadData();
             
             // 响应式处理
             window.addEventListener('resize', function() {
                 const charts = document.querySelectorAll('.chart');
                 charts.forEach(chart => {
                     const instance = echarts.getInstanceByDom(chart);
                     if (instance) {
                         instance.resize();
                     }
                 });
             });
         });
    </script>
</body>
</html> 